
<html>
  <head>
    <style>
      #sayIt { font-size: 24px; font-family:courier; }
      p { margin-bottom: -12px; margin-left:105px; text-indent: -105px; }
    </style>

    <script type="module"> // functions defined before targeted <div> tag, after <body> is rendered, in Module scripts are not defined ?? 

        var aScript6   ="{aScript6}"
     window.aScript6   =  aScript6

        var nCountries ="{nCountries = undefined}"
     window.nCountries =  nCountries

            say2("Head Module Script 5: defined before targeted <div> tag, after <body> is rendered, in Module scripts can be executed")   

     window.getCountries=        getCountries    // need to make functions, to be used in later Module scripts, global 
      async function getCountries( nRows ) {     // need to await getCountries in Module script below 

        var pResponse  =                   await fetch( "./assets/data/db.json" )
        var pJSON      =                   await pResponse.json()
//      var nCountries =`{nCountries = ${  await pResponse.json().countries.length }}` // aren't vars local to each module??  
       
//      var pJSON      =                  (await fetch( './assets/data/db.json' )).json() 
//      var nCountries =`{nCountries = ${ (await pJSON).countries.length }}` // aren't vars local to each module??  

//      var pJSON      =            await (await fetch( './assets/data/db.json' )).json() 
        var nCountries =`{nCountries = ${        pJSON .countries.length }}` // aren't vars local to each module??  
//   window.nCountries =`{nCountries = ${        pJSON .countries.length }}` // needs to be re-assigned into windows global scope if no await???

//      var pJSON      =            await (await fetch( './assets/data/db.json' )).json() 
        var mCountries =           (await (await fetch( './assets/data/db.json' )).json()).countries  
      
//          say1("Head Module Script 6: can be before targeted <div> tag, but executes after <body> is rendered and Normal scripts are executed")   
            say2("Head Module Script 6: execute: `await (await fetch( './assets/data/db.json' )).json()` in function getCountries()")
            say2(`Head Module Script 6: can see var, ${aScript6}, and var, ${nCountries}, assigned in same Module script`)
//          say2(`Head Module Script 6: can't see var, ${aScript7}, assigned in a later Module script`)

     return mCountries
            } 
             
    </script> 
    <script type="module">
        var aScript9="{aScript9}"
        window.onload = function( event ) { // executes after previous onload in Module scripts, before Normal scripts
            say2("Head Module Script 9: can see var, ${aScript7}, assigned in any script, but must be after document.onload") 
            } 
    </script>            

  </head>

  <body>
 
    <div id="sayIt"></div>

    <script type="module">   // Can only use Normal Script functions, not those in any Module scripts 

//          say1("Body Module Script 7: can be anywhere, but executes after <body> is rendered and Normal scripts are executed")   
            say2("Body Module Script 7: can be anywhere, but executes after <body> is rendered and Normal scripts are executed")   
//          say2(`Body Module Script 7: can't see var, ${aScript6} and ${nCountries}` ) // no workie for vars assigned in previous Module Scripts   
//          say3(`Body Module Script 7: can see var, window.${aScript6}, and but not var, window.${nCountries}, awaiting fetch()` ) 

        var mCountries =  await getCountries( ) 
        var nCountries =`{nCountries = ${ mCountries.length }}` 

            say2(`Body Module Script 8: can see var, ${aScript6}, and var, ${nCountries}, after await getCountries()` ) 
     </script>
    <script>                 // Must be a Normal script for Module scripts to use it's functions 
            say2("Botm Normal Script 4: must be at end of <body> tag, before or after functions are defined in same script")

  function  say2(a) { 
            pDiv = document.getElementById("sayIt")
            pDiv.innerHTML += "<p>say2: " + a.replace( /<(.+?)/g, '&lt;$1' ).replace( /(.+?)>/g, '$1&gt;') + "</p>"
            console.log(a) 
            }
    </script>
  </body>
</html>  